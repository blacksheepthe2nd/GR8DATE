<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Messages ‚Ä¢ GR8Date</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#f6f7fb; margin:0}
    .wrap{max-width:900px;margin:80px auto 20px;padding:16px}
    .card{background:#fff;border:1px solid #eaeef5;border-radius:12px;padding:0}
    .top{padding:14px 16px;border-bottom:1px solid #f0f3f8}
    h1{margin:0;font-size:20px;font-weight:800}
    .threads{display:flex;flex-direction:column}
    .thread{padding:14px 16px;border-bottom:1px solid #f8fafc;display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit;transition:background 0.2s}
    .thread:hover{background:#f8fafc}
    .thread:last-child{border-bottom:none}
    .avatar{width:44px;height:44px;border-radius:50%;object-fit:cover;background:#eaeef5}
    .info{flex:1}
    .name{font-weight:600;margin-bottom:4px}
    .preview{color:#64748b;font-size:14px;max-width:400px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .meta{color:#94a3b8;font-size:12px;text-align:right;min-width:80px}
    .empty{padding:40px 16px;text-align:center;color:#64748b}
    .empty-icon{font-size:48px;margin-bottom:16px;color:#cbd5e1}
    .header{position:fixed;top:0;left:0;right:0;background:#fff;border-bottom:1px solid #eaeef5;padding:12px 16px;display:flex;align-items:center;gap:12px;z-index:1000}
    .back-btn{background:none;border:none;font-size:20px;cursor:pointer;color:#64748b}
  </style>
</head>
<body>
  <div class="header">
    <a href="{% url 'dashboard' %}" class="back-btn">‚Üê</a>
    <div style="font-weight:800;font-size:18px">Messages</div>
  </div>

  <main class="wrap">
    <div class="card">
      {% if threads %}
        <div class="threads">
          {% for thread in threads %}
            {% if thread.user_a == request.user %}
              {% with other_user=thread.user_b %}
                <a href="{% url 'message_thread' other_user.id %}" class="thread">
                  <img src="{% if other_user.profile.primary_image_url %}{{ other_user.profile.primary_image_url }}{% else %}https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=100&auto=format&fit=crop{% endif %}" 
                       alt="{{ other_user.username }}" class="avatar">
                  <div class="info">
                    <div class="name">{{ other_user.get_full_name|default:other_user.username }}</div>
                    <div class="preview">
                      {% with last_message=thread.messages.first %}
                        {% if last_message %}
                          {{ last_message.text|truncatewords:10 }}
                        {% else %}
                          Start a conversation...
                        {% endif %}
                      {% endwith %}
                    </div>
                  </div>
                  <div class="meta">
                    {% with last_message=thread.messages.first %}
                      {% if last_message %}
                        {{ last_message.created_at|timesince }} ago
                      {% endif %}
                    {% endwith %}
                  </div>
                </a>
              {% endwith %}
            {% else %}
              {% with other_user=thread.user_a %}
                <a href="{% url 'message_thread' thread.id %}" class="thread">
                  <img src="{% if other_user.profile.primary_image_url %}{{ other_user.profile.primary_image_url }}{% else %}https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=100&auto=format&fit=crop{% endif %}" 
                       alt="{{ other_user.username }}" class="avatar">
                  <div class="info">
                    <div class="name">{{ other_user.get_full_name|default:other_user.username }}</div>
                    <div class="preview">
                      {% with last_message=thread.messages.first %}
                        {% if last_message %}
                          {{ last_message.text|truncatewords:10 }}
                        {% else %}
                          Start a conversation...
                        {% endif %}
                      {% endwith %}
                    </div>
                  </div>
                  <div class="meta">
                    {% with last_message=thread.messages.first %}
                      {% if last_message %}
                        {{ last_message.created_at|timesince }} ago
                      {% endif %}
                    {% endwith %}
                  </div>
                </a>
              {% endwith %}
            {% endif %}
          {% endfor %}
        </div>
      {% else %}
        <div class="empty">
          <div class="empty-icon">üí¨</div>
          <h3>No messages yet</h3>
          <p>Start a conversation with someone you like!</p>
        </div>
      {% endif %}
    </div>
  </main>
</body>
</html>
