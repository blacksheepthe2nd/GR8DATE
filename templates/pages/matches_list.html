{% extends 'base_header.html' %}
{% load static %}

{% block title %}Matches - GR8DATE{% endblock %}

{% block extra_css %}
/* Matches specific styles */
.muted{color:var(--muted);font-size:13px}

/* Username button style */
.username-btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:var(--brand);color:white;border-radius:10px;text-decoration:none;font-weight:600;font-size:14px;transition:all 0.2s}
.username-btn:hover{background:var(--brand-600);transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,43,106,0.3)}

/* Tabs - horizontal without wrapping */
.tabs{display:flex;gap:1px;margin-bottom:20px;background:var(--border);border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
.tab-btn{padding:12px 16px;border:none;background:#f8fafc;cursor:pointer;font-weight:600;font-size:14px;flex:1;text-align:center;transition:all 0.2s}
.tab-btn.active{background:var(--brand);color:white}
.tab-btn:not(.active):hover{background:#e2e8f0}
.tab-content{display:none}
.tab-content.active{display:block}

/* Compact match items */
.match-list{padding:0;margin:0;list-style:none}
.match-item{border-bottom:1px solid var(--border);padding:16px 0}
.match-item:last-child{border-bottom:none}
.match-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.match-info{flex:1}
.match-time{font-size:12px;color:var(--muted);margin-top:6px}
.empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
.empty-state .material-icons{font-size:64px;color:#e5e7eb;margin-bottom:16px}

/* Global navigation arrows */
.global-nav{display:flex;justify-content:center;gap:12px;margin:20px 0;padding:16px}
.nav-arrow{width:44px;height:44px;border-radius:12px;border:2px solid var(--border);background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted);font-size:20px;transition:all 0.2s}
.nav-arrow:hover{background:var(--brand);color:white;border-color:var(--brand);transform:translateY(-2px)}

/* Blocked user style */
.blocked-user .username-btn{background:#6b7280}
.blocked-user .username-btn:hover{background:#4b5563}

/* Mobile responsive */
@media (max-width: 768px) {
    .tabs{flex-direction:column;gap:2px}
    .tab-btn{padding:14px 12px;font-size:13px}
    .match-header{flex-direction:column;align-items:stretch;gap:12px}
    .username-btn{justify-content:center;padding:10px 14px}
    .global-nav{margin:16px 0;padding:12px}
    .nav-arrow{width:40px;height:40px}
}
{% endblock %}

{% block content %}
<h1 style="margin:0 0 20px 0;font-weight:800;color:var(--brand)">Matches</h1>

<div class="tabs">
    <button class="tab-btn active" data-tab="likes-given">Likes Given</button>
    <button class="tab-btn" data-tab="likes-received">Likes Received</button>
    <button class="tab-btn" data-tab="blocked">Blocked Users</button>
</div>

<!-- Likes Given Tab -->
<div class="tab-content active" id="likes-given">
    {% if likes_given %}
        <ul class="match-list">
            {% for like in likes_given %}
            <li class="match-item">
                <div class="match-header">
                    <div class="match-info">
                        <a href="{% url 'profile_detail' like.liked_user.id %}" class="username-btn">
                            <span class="material-icons" style="font-size:16px">person</span>
                            {{ like.liked_user.username }}
                        </a>
                        <div class="match-time">
                            Liked on {{ like.created_at|date:"M j, Y" }}
                            {% if like.liked_user.profile.location %} • {{ like.liked_user.profile.location }}{% endif %}
                            {% if like.liked_user.profile.age %} • {{ like.liked_user.profile.age }} years old{% endif %}
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        
        <!-- Global Navigation Arrows -->
        <div class="global-nav">
            <button class="nav-arrow" id="prev-match" title="Previous">
                <span class="material-icons">keyboard_arrow_up</span>
            </button>
            <button class="nav-arrow" id="next-match" title="Next">
                <span class="material-icons">keyboard_arrow_down</span>
            </button>
        </div>
    {% else %}
        <div class="empty-state">
            <span class="material-icons">favorite</span>
            <h3>No likes given yet</h3>
            <p>Start exploring profiles and like people you're interested in!</p>
            <a href="{% url 'dashboard' %}" class="username-btn" style="margin-top:16px">
                <span class="material-icons">explore</span> Explore Profiles
            </a>
        </div>
    {% endif %}
</div>

<!-- Likes Received Tab -->
<div class="tab-content" id="likes-received">
    {% if likes_received %}
        <ul class="match-list">
            {% for like in likes_received %}
            <li class="match-item">
                <div class="match-header">
                    <div class="match-info">
                        <a href="{% url 'profile_detail' like.liker.id %}" class="username-btn">
                            <span class="material-icons" style="font-size:16px">person</span>
                            {{ like.liker.username }}
                        </a>
                        <div class="match-time">
                            Liked you on {{ like.created_at|date:"M j, Y" }}
                            {% if like.liker.profile.location %} • {{ like.liker.profile.location }}{% endif %}
                            {% if like.liker.profile.age %} • {{ like.liker.profile.age }} years old{% endif %}
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        
        <!-- Global Navigation Arrows -->
        <div class="global-nav">
            <button class="nav-arrow" id="prev-match-received" title="Previous">
                <span class="material-icons">keyboard_arrow_up</span>
            </button>
            <button class="nav-arrow" id="next-match-received" title="Next">
                <span class="material-icons">keyboard_arrow_down</span>
            </button>
        </div>
    {% else %}
        <div class="empty-state">
            <span class="material-icons">favorite_border</span>
            <h3>No likes received yet</h3>
            <p>When people like your profile, they'll appear here.</p>
            <a href="{% url 'profile_edit' %}" class="username-btn" style="margin-top:16px">
                <span class="material-icons">edit</span> Improve Your Profile
            </a>
        </div>
    {% endif %}
</div>

<!-- Blocked Users Tab -->
<div class="tab-content" id="blocked">
    {% if blocked_users %}
        <ul class="match-list">
            {% for block in blocked_users %}
            <li class="match-item blocked-user">
                <div class="match-header">
                    <div class="match-info">
                        <span class="username-btn" style="cursor:default">
                            <span class="material-icons" style="font-size:16px">block</span>
                            {{ block.blocked.username }}
                        </span>
                        <div class="match-time">
                            Blocked on {{ block.created_at|date:"M j, Y" }}
                        </div>
                    </div>
                    <a href="{% url 'unblock_user' block.blocked.id %}" style="color:#10b981;font-size:13px;font-weight:600;text-decoration:none">
                        Unblock
                    </a>
                </div>
            </li>
            {% endfor %}
        </ul>
        
        <!-- Global Navigation Arrows -->
        <div class="global-nav">
            <button class="nav-arrow" id="prev-match-blocked" title="Previous">
                <span class="material-icons">keyboard_arrow_up</span>
            </button>
            <button class="nav-arrow" id="next-match-blocked" title="Next">
                <span class="material-icons">keyboard_arrow_down</span>
            </button>
        </div>
    {% else %}
        <div class="empty-state">
            <span class="material-icons">block</span>
            <h3>No blocked users</h3>
            <p>Users you block will appear here.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons and contents
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button
            this.classList.add('active');
            
            // Show corresponding content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Global arrow navigation for each tab
    function setupNavigation(prevId, nextId) {
        const prevBtn = document.getElementById(prevId);
        const nextBtn = document.getElementById(nextId);
        
        if (prevBtn && nextBtn) {
            prevBtn.addEventListener('click', function() {
                navigateMatches('up', this.closest('.tab-content').id);
            });
            
            nextBtn.addEventListener('click', function() {
                navigateMatches('down', this.closest('.tab-content').id);
            });
        }
    }
    
    function navigateMatches(direction, tabId) {
        const activeTab = document.getElementById(tabId);
        const matchItems = activeTab.querySelectorAll('.match-item');
        if (matchItems.length === 0) return;
        
        const firstItem = matchItems[0];
        const lastItem = matchItems[matchItems.length - 1];
        
        if (direction === 'up') {
            firstItem.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else if (direction === 'down') {
            lastItem.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
    }
    
    // Setup navigation for each tab
    setupNavigation('prev-match', 'next-match');
    setupNavigation('prev-match-received', 'next-match-received');
    setupNavigation('prev-match-blocked', 'next-match-blocked');
});
</script>
{% endblock %}
