{% extends "base.html" %}

{% block title %}Edit Profile - Dating App{% endblock %}

{% block content %}
<div class="main-content">
    <!-- Photo Section -->
    <div class="profile-section">
        <h2>Profile Photos</h2>
        
        <!-- Profile Photo -->
        <div class="photo-section">
            <h3>Profile Photo</h3>
            <div class="profile-photo-main">
                <div class="photo-placeholder">
                    <img src="{{ current_profile_photo }}" alt="Current profile photo" class="current-photo">
                </div>
                <button type="button" class="btn-change-photo">Change Photo</button>
            </div>
        </div>

        <!-- Additional Photos -->
        <div class="photo-section">
            <h3>Additional Photos (up to 4)</h3>
            <div class="photo-grid">
                {% for photo in additional_photos %}
                <div class="photo-item">
                    <img src="{{ photo.url }}" alt="Additional photo {{ loop.index }}">
                    <button type="button" class="btn-delete" onclick="deleteAdditionalPhoto({{ photo.id }})">×</button>
                </div>
                {% endfor %}
                
                {% if additional_photos|length < 4 %}
                <div class="photo-item add-photo-btn" onclick="addAdditionalPhoto()">
                    <span>+ Add</span>
                </div>
                {% endif %}
            </div>
            <div class="photo-count">{{ additional_photos|length }}/4 additional photos</div>
        </div>

        <!-- Private Photos -->
        <div class="photo-section">
            <h3>Private Photos (up to 4, blurred to others)</h3>
            <div class="photo-grid">
                {% for photo in private_photos %}
                <div class="photo-item">
                    <img src="{{ photo.url }}" alt="Private photo {{ loop.index }}" class="private-photo">
                    <button type="button" class="btn-delete" onclick="deletePrivatePhoto({{ photo.id }})">×</button>
                </div>
                {% endfor %}
                
                {% if private_photos|length < 4 %}
                <div class="photo-item add-photo-btn" onclick="addPrivatePhoto()">
                    <span>+ Add</span>
                </div>
                {% endif %}
            </div>
            <div class="photo-count">{{ private_photos|length }}/4 private photos</div>
        </div>
    </div>

    <!-- Lifestyle Section -->
    <div class="profile-section">
        <h2>Lifestyle</h2>
        <div class="grid-2">
            <div class="field"><label>Smoking</label><select name="smoking"><option value="prefer_not" {% if me.smoking == 'prefer_not' %}selected{% endif %}>Prefer not to say</option><option value="never" {% if me.smoking == 'never' %}selected{% endif %}>Never</option><option value="occasionally" {% if me.smoking == 'occasionally' %}selected{% endif %}>Occasionally</option><option value="regularly" {% if me.smoking == 'regularly' %}selected{% endif %}>Regularly</option></select></div>
            <div class="field"><label>Drinking</label><select name="drinking"><option value="prefer_not" {% if me.drinking == 'prefer_not' %}selected{% endif %}>Prefer not to say</option><option value="never" {% if me.drinking == 'never' %}selected{% endif %}>Never</option><option value="socially" {% if me.drinking == 'socially' %}selected{% endif %}>Socially</option><option value="regularly" {% if me.drinking == 'regularly' %}selected{% endif %}>Regularly</option></select></div>
            <div class="field"><label>Exercise</label><select name="exercise"><option value="prefer_not" {% if me.exercise == 'prefer_not' %}selected{% endif %}>Prefer not to say</option><option value="never" {% if me.exercise == 'never' %}selected{% endif %}>Never</option><option value="occasionally" {% if me.exercise == 'occasionally' %}selected{% endif %}>Occasionally</option><option value="regularly" {% if me.exercise == 'regularly' %}selected{% endif %}>Regularly</option><option value="daily" {% if me.exercise == 'daily' %}selected{% endif %}>Daily</option></select></div>
            <div class="field"><label>Pets</label><select name="pets"><option value="prefer_not" {% if me.pets == 'prefer_not' %}selected{% endif %}>Prefer not to say</option><option value="none" {% if me.pets == 'none' %}selected{% endif %}>None</option><option value="cats" {% if me.pets == 'cats' %}selected{% endif %}>Cats</option><option value="dogs" {% if me.pets == 'dogs' %}selected{% endif %}>Dogs</option><option value="both" {% if me.pets == 'both' %}selected{% endif %}>Both</option><option value="other" {% if me.pets == 'other' %}selected{% endif %}>Other</option></select></div>
            <div class="field"><label>Diet</label><select name="diet"><option value="prefer_not" {% if me.diet == 'prefer_not' %}selected{% endif %}>Prefer not to say</option><option value="omnivore" {% if me.diet == 'omnivore' %}selected{% endif %}>Omnivore</option><option value="vegetarian" {% if me.diet == 'vegetarian' %}selected{% endif %}>Vegetarian</option><option value="vegan" {% if me.diet == 'vegan' %}selected{% endif %}>Vegan</option><option value="pescatarian" {% if me.diet == 'pescatarian' %}selected{% endif %}>Pescatarian</option><option value="other" {% if me.diet == 'other' %}selected{% endif %}>Other</option></select></div>

            <!-- My Interests (Tags) - MATCHING CREATE PROFILE -->
            <div class="field" style="grid-column:1/-1">
                <label>My interests (tags)</label>
                <div class="tag-options" style="display:flex;flex-wrap:wrap;gap:8px;border:1px solid var(--border);border-radius:10px;padding:12px;background:var(--bg-muted);min-height:60px;">
                    <!-- Your specific tags -->
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="hiking" {% if 'hiking' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Hiking</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="beach" {% if 'beach' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Beach</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="dogs" {% if 'dogs' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Dogs</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="books" {% if 'books' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Books</span>
                    </label>
                    
                    <!-- Additional tags -->
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="music" {% if 'music' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Music</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="travel" {% if 'travel' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Travel</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="movies" {% if 'movies' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Movies</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="gaming" {% if 'gaming' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Gaming</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="cooking" {% if 'cooking' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Cooking</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="fitness" {% if 'fitness' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Fitness</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="art" {% if 'art' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Art</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="technology" {% if 'technology' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Technology</span>
                    </label>
                    
                    <!-- Contact me tag -->
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="my_interests[]" value="contact_to_know_more" {% if 'contact_to_know_more' in me.my_interests %}checked{% endif %} style="margin-right:6px;">
                        <span>Contact me to know more</span>
                    </label>
                </div>
                <small class="badge-note">Shown on your profile and used to match you with others.</small>
            </div>
        </div>
    </div>

    <!-- Preferences Section -->
    <div class="profile-section">
        <h2>Preferences — Who I'm looking for</h2>
        <div class="grid-2">
            <div class="field">
                <label>Preferred age range</label>
                <div style="display:flex;gap:8px;align-items:center">
                    <select id="prefAgeMin" name="preferred_age_min">
                        <!-- Age options will be populated by JavaScript -->
                    </select>
                    <span>to</span>
                    <select id="prefAgeMax" name="preferred_age_max">
                        <!-- Age options will be populated by JavaScript -->
                    </select>
                </div>
                <small class="err" id="errAgeRange" style="display:none">Min age should be less than or equal to max age.</small>
                <small class="badge-note">Tip: choose a range wide enough for good matches.</small>
            </div>
                        
            <div class="field">
                <label>Distance</label>
                <select id="prefDistance" name="preferred_distance">
                    <option value="any" {% if me.preferred_distance == 'any' %}selected{% endif %}>Any</option>
                    <option value="5" {% if me.preferred_distance == '5' %}selected{% endif %}>5 km</option>
                    <option value="10" {% if me.preferred_distance == '10' %}selected{% endif %}>10 km</option>
                    <option value="25" {% if me.preferred_distance == '25' %}selected{% endif %}>25 km</option>
                    <option value="50" {% if me.preferred_distance == '50' %}selected{% endif %}>50 km</option>
                    <option value="100" {% if me.preferred_distance == '100' %}selected{% endif %}>100 km</option>
                    <option value="country" {% if me.preferred_distance == 'country' %}selected{% endif %}>Countrywide</option>
                </select>
            </div>
                    
            <div class="field">
                <label>Intent</label>
                <select id="prefIntent" name="preferred_intent">
                    <option value="any" {% if me.preferred_intent == 'any' %}selected{% endif %}>Any</option>
                    <option value="friends" {% if me.preferred_intent == 'friends' %}selected{% endif %}>New friends</option>
                    <option value="casual" {% if me.preferred_intent == 'casual' %}selected{% endif %}>Casual dating</option>
                    <option value="longterm" {% if me.preferred_intent == 'longterm' %}selected{% endif %}>Long-term</option>
                    <option value="marriage" {% if me.preferred_intent == 'marriage' %}selected{% endif %}>Marriage</option>
                </select>
            </div>
                
            <!-- Must-Have Tags - MATCHING CREATE PROFILE -->
            <div class="field" style="grid-column:1/-1">
                <label>Must-have tags</label>
                <div class="tag-options" style="display:flex;flex-wrap:wrap;gap:8px;border:1px solid var(--border);border-radius:10px;padding:12px;background:var(--bg-muted);min-height:60px;">
                    <!-- Your specific tags -->
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="hiking" {% if 'hiking' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Hiking</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="beach" {% if 'beach' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Beach</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="dogs" {% if 'dogs' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Dogs</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="books" {% if 'books' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Books</span>
                    </label>
                    
                    <!-- Additional must-have trait tags -->
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="honest" {% if 'honest' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Honest</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="kind" {% if 'kind' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Kind</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="ambitious" {% if 'ambitious' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Ambitious</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="humorous" {% if 'humorous' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Humorous</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="adventurous" {% if 'adventurous' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Adventurous</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="loyal" {% if 'loyal' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Loyal</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="compassionate" {% if 'compassionate' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Compassionate</span>
                    </label>
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="confident" {% if 'confident' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Confident</span>
                    </label>
                    
                    <!-- Contact me tag -->
                    <label class="tag-option" style="display:flex;align-items:center;padding:6px 12px;background:white;border:2px solid #e9ecef;border-radius:20px;cursor:pointer;transition:all 0.3s;">
                        <input type="checkbox" name="must_have_tags[]" value="contact_to_know_more" {% if 'contact_to_know_more' in me.must_have_tags %}checked{% endif %} style="margin-right:6px;">
                        <span>Contact me to know more</span>
                    </label>
                </div>
                <small class="badge-note">These tags will be used as filters in search & matching.</small>
            </div>
        </div>
    </div>

    <!-- Save Button -->
    <div class="form-actions">
        <button type="submit" class="btn-save">Save Changes</button>
        <button type="button" class="btn-cancel">Cancel</button>
    </div>
</div>

<style>
    /* Photo Section Styles */
    .profile-section {
        background: white;
        padding: 2rem;
        margin-bottom: 2rem;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .photo-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        background: #fafafa;
    }
    
    .photo-section h3 {
        margin-bottom: 1rem;
        color: #555;
        font-size: 1.1rem;
    }
    
    .profile-photo-main {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    
    .photo-placeholder {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        overflow: hidden;
        border: 3px solid #667eea;
    }
    
    .current-photo {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .btn-change-photo {
        padding: 0.75rem 1.5rem;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s;
    }
    
    .btn-change-photo:hover {
        background: #5a6fd8;
    }
    
    .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .photo-item {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 10px;
        overflow: hidden;
        border: 2px dashed #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f0f0f0;
        cursor: pointer;
    }
    
    .photo-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .btn-delete {
        position: absolute;
        top: 5px;
        right: 5px;
        width: 24px;
        height: 24px;
        background: #ff4444;
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .add-photo-btn {
        background: #e8f4ff;
        border: 2px dashed #667eea;
        color: #667eea;
        font-weight: bold;
        font-size: 1.5rem;
    }
    
    .add-photo-btn:hover {
        background: #d4eaff;
    }
    
    .private-photo {
        filter: blur(5px);
    }
    
    .photo-count {
        font-size: 0.9rem;
        color: #666;
        font-style: italic;
    }
    
    /* Form Actions */
    .form-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
    }
    
    .btn-save {
        padding: 1rem 2rem;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
    }
    
    .btn-save:hover {
        background: #5a6fd8;
    }
    
    .btn-cancel {
        padding: 1rem 2rem;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1rem;
    }
    
    .btn-cancel:hover {
        background: #5a6268;
    }

    /* Grid layout for forms */
    .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }
    
    .field {
        display: flex;
        flex-direction: column;
    }
    
    .field label {
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #333;
    }
    
    .field select, .field input {
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
    }
    
    .badge-note {
        color: #666;
        font-size: 0.85rem;
        margin-top: 0.5rem;
        display: block;
    }
</style>

<script>
    function deleteAdditionalPhoto(photoId) {
        if (confirm('Are you sure you want to delete this photo?')) {
            // AJAX call to delete additional photo
            console.log('Deleting additional photo:', photoId);
        }
    }
    
    function deletePrivatePhoto(photoId) {
        if (confirm('Are you sure you want to delete this private photo?')) {
            // AJAX call to delete private photo
            console.log('Deleting private photo:', photoId);
        }
    }
    
    function addAdditionalPhoto() {
        // Trigger file input for additional photo
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = function(e) {
            console.log('Additional photo selected:', e.target.files[0]);
        };
        input.click();
    }
    
    function addPrivatePhoto() {
        // Trigger file input for private photo
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = function(e) {
            console.log('Private photo selected:', e.target.files[0]);
        };
        input.click();
    }

    // Age range dropdown population
    document.addEventListener('DOMContentLoaded', function() {
        const minSelect = document.getElementById('prefAgeMin');
        const maxSelect = document.getElementById('prefAgeMax');
        
        // Populate age options from 18 to 80
        for (let age = 18; age <= 80; age++) {
            const option = document.createElement('option');
            option.value = age;
            option.textContent = age;
            minSelect.appendChild(option.cloneNode(true));
            maxSelect.appendChild(option);
        }
        
        // Set default values if not already set
        if (!minSelect.value) minSelect.value = 18;
        if (!maxSelect.value) maxSelect.value = 80;
    });
</script>
{% endblock %}
